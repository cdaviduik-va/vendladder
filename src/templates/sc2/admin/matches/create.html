{% extends "sc2/global.html" %}

{% block content %}
<h2>Add Match to Schedule (admin)</h2>

<p>
    Players do not submit scores for the games this season.  Instead they upload the replays from the games played.  As
    per the previous season rules, failure to submit matches before the deadline will result in a loss for both teams.
</p>

{% if is_debug %}

    <h3>DEBUG: Current Season</h3>
    <pre>{{ current_season }}</pre>

    <h3>DEBUG: "Remaining Rounds</h3>
    <pre>{{ remaining_rounds }}</pre>

    <h3>DEBUG: Players</h3>
    <pre>{{ players }}</pre>

{% endif %}

<h3>Suggested Matches</h3>

<table class="table">
    <thead>
        <tr>
            <th>Team 1</th>
            <th>Team 2</th>
            <th>Team 1 Average Score</th>
            <th>Team 2 Average Score</th>
            <th>Average Games Played</th>
            <th>Score Diff</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for match in suggested_matches[:20] %}
            <tr>
                <td>
                    {% for player_rank in match.team1 %}
                        {{ player_rank.battle_net_name }}
                        {% if not loop.last %}
                            &
                        {% endif %}
                    {% endfor %}
                </td><td>
                    {% for player_rank in match.team2 %}
                        {{ player_rank.battle_net_name }}
                        {% if not loop.last %}
                            &
                        {% endif %}
                    {% endfor %}
                </td><td>
                    {{ match.team1_average_score }}
                </td><td>
                    {{ match.team2_average_score }}
                </td><td>
                    {{ match.average_games_played }}
                </td><td>
                    {{ match.score_diff }}
                </td><td>
                    <a href="#" class="btn btn-primary">Create Match</a>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<form method="post" action="/sc2/admin/match/submit">
    <label>Round:</label><select></select>

    <h3>Team 1</h3>
    <div><label>Player 1</label><select name="team1-player1" data-bind="options: players, optionsText: 'name'"></select></div>
    <div><label>Player 2</label><select name="team1-player2" data-bind="options: players, optionsText: 'name'"></select></div>

    <h3>Team 2</h3>
    <div><label>Player 1</label><select name="team2-player1" data-bind="options: players, optionsText: 'name'"></select></div>
    <div><label>Player 2</label><select name="team2-player2" data-bind="options: players, optionsText: 'name'"></select></div>
    <hr />
    <input type="submit" name="Submit" />
</form>
<br style="clear:both">
<a href="/sc2/admin/">Back to admin functions</a>
{% endblock %}

{% block script %}
<script type="text/javascript" language="javascript">
    var players = {{players | safe}};
    var viewModel = null;

    function PlayerModel(data) {
        var self = this;

        self.name = ko.observable(data.name);
        self.battle_net_name = ko.observable(data.battle_net_name);
        self.score = ko.observable(data.score);
        self.vendasta_email = ko.observable(data.vendasta_email);
    }

    function CreateMatchViewModel(playerData) {
        var self = this;

        self.players = ko.observableArray();

        //Initialization
        for(var i=0; i<playerData.length; i++) {
            var player = new PlayerModel(playerData[i]);
            self.players.push(player);
        }
    }

    $(function() {
        //Initial setup
        viewModel = new CreateMatchViewModel(players);
        ko.applyBindings(viewModel);
    });
</script>
{% endblock %}